{"remainingRequest":"/Users/xay/MovieTicketSystem/vue-app/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xay/MovieTicketSystem/vue-app/src/views/Seat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/xay/MovieTicketSystem/vue-app/src/views/Seat.vue","mtime":1681465603935},{"path":"/Users/xay/MovieTicketSystem/vue-app/node_modules/cache-loader/dist/cjs.js","mtime":1681457359149},{"path":"/Users/xay/MovieTicketSystem/vue-app/node_modules/vue-loader/lib/index.js","mtime":1681457360544}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7RmluZEFycmFuZ2VtZW50QnlJZCwgR2V0QXJyYW5nZW1lbnRTZWF0c30gZnJvbSAiQC9hcGkvZmlsbSI7CmltcG9ydCB7Q3JlYXRlQ2FydCwgRGVsZXRlQ2FydEJ5SWR9IGZyb20gIkAvYXBpL2NhcnQiOwppbXBvcnQge0NyZWF0ZU9yZGVyLCBQYXlGb3JPcmRlcn0gZnJvbSAiQC9hcGkvb3JkZXIiOwoKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjYXJ0OiB7CiAgICAgICAgdWlkOiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgidWlkIiksCiAgICAgICAgYWlkOiB0aGlzLiRyb3V0ZS5xdWVyeS5pZCwKICAgICAgICBzZWF0czogJycsCiAgICAgICAgcGhvbmU6ICIiLAogICAgICAgIHByaWNlOiAwCiAgICAgIH0sCiAgICAgIGFycmFuZ2VtZW50OiB7fSwKICAgICAgZmlsbToge30sCiAgICAgIHNlYXRzOiBbXSwKICAgICAgdXNlclNlbGVjdFNlYXRzOiBbXSwKICAgICAgc2VsZWN0U2VhdHM6IFtdLAogICAgfQogIH0sCgogIG1vdW50ZWQoKSB7CiAgICBGaW5kQXJyYW5nZW1lbnRCeUlkKHRoaXMuJHJvdXRlLnF1ZXJ5LmlkKS50aGVuKChyZXMpID0+IHsKICAgICAgdGhpcy5hcnJhbmdlbWVudCA9IHJlcy5kYXRhLmFycmFuZ2VtZW50OwogICAgICB0aGlzLmZpbG0gPSByZXMuZGF0YS5maWxtOwogICAgICBHZXRBcnJhbmdlbWVudFNlYXRzKHRoaXMuJHJvdXRlLnF1ZXJ5LmlkKS50aGVuKHJlcyA9PiB7CiAgICAgICAgdGhpcy5zZWxlY3RTZWF0cyA9IHJlcy5kYXRhOwogICAgICAgIHRoaXMubG9hZFNlYXRzKCk7CiAgICAgIH0pCiAgICB9KTsKICB9LAoKICBtZXRob2RzOiB7CiAgICAvLzAg5bey6YCJCiAgICAvLzEg5Y+v6YCJCiAgICAvLzIg5bey6YCJ5LitCiAgICBsb2FkU2VhdHMoKSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLmFycmFuZ2VtZW50LnNlYXROdW1iZXIKICAgICAgbGV0IGFyciA9IG5ldyBBcnJheShuKQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG47IGkrKykgewogICAgICAgIGlmICh0aGlzLnNlbGVjdFNlYXRzLmluZGV4T2YoaSArIDEpID09PSAtMSkgewogICAgICAgICAgYXJyW2ldID0ge3NlYXQ6IGkgKyAxLCBzdGF0dXM6IDF9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFycltpXSA9IHtzZWF0OiBpICsgMSwgc3RhdHVzOiAwfQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnNlYXRzID0gYXJyCiAgICB9LAoKICAgIGhhbmRsZVNlbGVjdChpbmRleCkgewogICAgICBpZiAodGhpcy51c2VyU2VsZWN0U2VhdHMubGVuZ3RoID49IDQpIHsKICAgICAgICBsZXQgZCA9IHRoaXMudXNlclNlbGVjdFNlYXRzWzBdIC0gMQogICAgICAgIHRoaXMuc2VhdHNbZF0uc3RhdHVzID0gMQogICAgICAgIHRoaXMudXNlclNlbGVjdFNlYXRzLnNwbGljZSgwLCAxKQogICAgICB9CiAgICAgIHRoaXMudXNlclNlbGVjdFNlYXRzLnB1c2goaW5kZXggKyAxKQogICAgICB0aGlzLnNlYXRzW2luZGV4XS5zdGF0dXMgPSAyCiAgICAgIHRoaXMuY2FydC5wcmljZSA9ICh0aGlzLmFycmFuZ2VtZW50LnByaWNlKSAqICh0aGlzLnVzZXJTZWxlY3RTZWF0cy5sZW5ndGgpCiAgICB9LAoKICAgIGhhbmRsZURpc1NlbGVjdChpbmRleCkgewogICAgICB0aGlzLnNlYXRzW2luZGV4XS5zdGF0dXMgPSAxCiAgICAgIHRoaXMudXNlclNlbGVjdFNlYXRzLnNwbGljZSh0aGlzLnVzZXJTZWxlY3RTZWF0cy5pbmRleE9mKGluZGV4ICsgMSksIDEpCiAgICAgIHRoaXMuY2FydC5wcmljZSA9ICh0aGlzLmFycmFuZ2VtZW50LnByaWNlKSAqICh0aGlzLnVzZXJTZWxlY3RTZWF0cy5sZW5ndGgpCiAgICB9LAoKICAgIGNoZWNrUGhvbmVBbmRTZWF0cygpIHsKICAgICAgaWYgKHRoaXMudXNlclNlbGVjdFNlYXRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgbWVzc2FnZTogJ+ivt+mAieaLqeimgeiuoui0reeahOW6p+S9jScsCiAgICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY2FydC5waG9uZS5sZW5ndGggIT09IDExKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICBtZXNzYWdlOiAn6K+36L6T5YWlMTHkvY3nmoTnlLXor53lj7fnoIEnLAogICAgICAgICAgdHlwZTogJ3dhcm5pbmcnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKCiAgICBzdWJtaXRTZWF0KCkgewogICAgICBpZiAodGhpcy5jaGVja1Bob25lQW5kU2VhdHMoKSkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy51c2VyU2VsZWN0U2VhdHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHRoaXMuY2FydC5zZWF0cyArPSB0aGlzLnVzZXJTZWxlY3RTZWF0c1tpXSArICflj7cnCiAgICAgICAgfQogICAgICAgIGNvbnNvbGUubG9nKHRoaXMuY2FydCkKICAgICAgICBDcmVhdGVDYXJ0KHRoaXMuY2FydCkudGhlbihyZXMgPT4gewogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgIG1lc3NhZ2U6ICfku6XkuLrmgqjmt7vliqDotK3nianovabmiJDlip/vvIzor7flsL3lv6vku5jmrL7lkKcnLAogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKQogICAgICAgIH0pCgogICAgICB9CiAgICB9LAogICAgc3VibWl0Q2FydCgpIHsKICAgICAgaWYgKHRoaXMuY2hlY2tQaG9uZUFuZFNlYXRzKCkpIHsKICAgICAgICB0aGlzLiRjb25maXJtKCfor7fmgqjku5Tnu4bnoa7orqTorqLljZXph5Hpop3kuLonICsgdGhpcy5jYXJ0LnByaWNlICsgJ+WFgywg5piv5ZCm57un57utPycsICfmj5DnpLonLCB7CiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruiupOaUr+S7mCcsCiAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raI5pSv5LuYJywKICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywKICAgICAgICAgIGNlbnRlcjogdHJ1ZQogICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnVzZXJTZWxlY3RTZWF0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0aGlzLmNhcnQuc2VhdHMgKz0gdGhpcy51c2VyU2VsZWN0U2VhdHNbaV0gKyAn5Y+3JwogICAgICAgICAgfQogICAgICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLmNhcnQpCiAgICAgICAgICB0aGlzLmNhcnQuc3RhdHVzID0gMgogICAgICAgICAgLy90aGlzLmNlbnRlckRpYWxvZ1Zpc2libGUgPSB0cnVlCiAgICAgICAgICAvL3RoaXMuaSA9IGkKICAgICAgICAgIENyZWF0ZU9yZGVyKHRoaXMuY2FydCkudGhlbihyZXMgPT4gewogICAgICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfmga3llpzkvaDmlK/ku5jmiJDlip8hJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICAgIENyZWF0ZU9yZGVyKHRoaXMuY2FydCkudGhlbihyZXMgPT4gewogICAgICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICBEZWxldGVDYXJ0QnlJZCh0aGlzLnNlbGVjdExpc3RbaV0uY2FydC5pZCkKICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfnlKjmiLflt7Llj5bmtojmlK/ku5gsIOivt+aCqOWJjeW+gOaIkeeahOiuouWNlei/m+ihjOaUr+S7mCcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLmxvYWRDYXJ0cygpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogIH0sCn07Cg=="},{"version":3,"sources":["Seat.vue"],"names":[],"mappings":";AAgHA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"Seat.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"seat-main\">\n    <el-steps style=\"padding-bottom: 50px\" :active=\"2\" align-center>\n      <el-step title=\"步骤1\" description=\"选择电影场次\"></el-step>\n      <el-step title=\"步骤2\" description=\"选择座位号\"></el-step>\n      <el-step title=\"步骤3\" description=\"加入购物车\"></el-step>\n      <el-step title=\"步骤4\" description=\"结算付款\"></el-step>\n    </el-steps>\n    <div class=\"seat-content\">\n      <div class=\"seat-aside\">\n        <div style=\"display: flex\">\n          <img style=\"padding: 30px\" :src=\"film.cover\" alt=\"\"/>\n          <div>\n            <div\n                style=\"\n                padding-top: 40px;\n                padding-bottom: 10px;\n                font-size: 25px;\n                letter-spacing: 2px;\n              \"\n            >\n              {{ film.name }}\n            </div>\n            <div class=\"seat-aside-text\">类型：{{ film.type }}</div>\n            <div class=\"seat-aside-text\">地区：{{ film.region }}</div>\n            <div class=\"seat-aside-text\">时长：{{ film.duration }}分钟</div>\n          </div>\n        </div>\n        <div style=\"padding: 5px 30px\">\n          <div class=\"d1\"><span>放映：</span>{{ arrangement.type }}</div>\n          <div class=\"d1\" style=\"color: #f56c6c\">\n            <span>开场：</span>{{ arrangement.date }}\n            {{ arrangement.startTime }}\n          </div>\n          <div class=\"d1\"><span>散场：</span>{{ arrangement.endTime }}</div>\n          <div class=\"d1\"><span>票价：</span>¥{{ arrangement.price }}/张</div>\n          <el-divider></el-divider>\n          <div class=\"d1\">\n            已选座位：\n            <el-tag v-for=\"(item, i) in userSelectSeats\" :key=\"i\"\n                    type=\"danger\"\n                    style=\"margin-right: 5px\"\n                    effect=\"plain\">\n              {{ item }} 号\n            </el-tag>\n          </div>\n          <div class=\"d1\" style=\"padding-top: 10px\">\n            总计：\n            <span style=\"color: #f56c6c\">¥ </span>\n            <span style=\"color: #f56c6c; font-size: 25px; font-weight: bold\"\n            >{{ cart.price }}</span\n            >\n          </div>\n          <el-divider></el-divider>\n          <div style=\"padding: 0 50px\">\n            <el-input\n                v-model=\"cart.phone\"\n                style=\"padding-top: 20px; padding-bottom: 30px\"\n                placeholder=\"请输入手机号码\"\n                clearable\n            >\n            </el-input>\n            <el-button @click=\"submitSeat\" class=\"add-cart-btn\" type=\"danger\" round\n            >加入购物车\n            </el-button>\n            <el-button @click=\"submitCart\" class=\"add-cart-btn\" type=\"primary\" round\n            >立即付款\n            </el-button>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"hall seat-select\">\n        <div style=\"padding-left: 30px\" class=\"seat-example\">\n          <div class=\"selectable-example example\">\n            <span>可选座位</span>\n          </div>\n          <div class=\"sold-example example\">\n            <span>已售座位</span>\n          </div>\n          <div class=\"selected-example example\">\n            <span>已选座位</span>\n          </div>\n        </div>\n\n        <div class=\"seats-block\">\n          <div class=\"seats-container\">\n            <div class=\"screen-container\" style=\"left: 5px\">\n              <div class=\"screen\">银幕中央</div>\n              <div class=\"c-screen-line\"></div>\n            </div>\n\n            <div class=\"seats-wrapper\">\n              <div style=\"padding: 0 40px;width: 500px\">\n                <span v-for=\"(item, index) in seats\" :key=\"index\">\n                  <!--不可选-->\n                  <span v-if=\"item.status === 0\" class=\"seat sold item\"/>\n                  <!--可选-->\n                  <span v-if=\"item.status === 1\" @click=\"handleSelect(index)\" class=\"seat selectable item\"/>\n                  <!--已选-->\n                  <span v-if=\"item.status === 2\" @click=\"handleDisSelect(index)\" class=\"seat selected item\"/>\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {FindArrangementById, GetArrangementSeats} from \"@/api/film\";\nimport {CreateCart, DeleteCartById} from \"@/api/cart\";\nimport {CreateOrder, PayForOrder} from \"@/api/order\";\n\nexport default {\n  data() {\n    return {\n      cart: {\n        uid: localStorage.getItem(\"uid\"),\n        aid: this.$route.query.id,\n        seats: '',\n        phone: \"\",\n        price: 0\n      },\n      arrangement: {},\n      film: {},\n      seats: [],\n      userSelectSeats: [],\n      selectSeats: [],\n    }\n  },\n\n  mounted() {\n    FindArrangementById(this.$route.query.id).then((res) => {\n      this.arrangement = res.data.arrangement;\n      this.film = res.data.film;\n      GetArrangementSeats(this.$route.query.id).then(res => {\n        this.selectSeats = res.data;\n        this.loadSeats();\n      })\n    });\n  },\n\n  methods: {\n    //0 已选\n    //1 可选\n    //2 已选中\n    loadSeats() {\n      const n = this.arrangement.seatNumber\n      let arr = new Array(n)\n      for (let i = 0; i < n; i++) {\n        if (this.selectSeats.indexOf(i + 1) === -1) {\n          arr[i] = {seat: i + 1, status: 1}\n        } else {\n          arr[i] = {seat: i + 1, status: 0}\n        }\n      }\n      this.seats = arr\n    },\n\n    handleSelect(index) {\n      if (this.userSelectSeats.length >= 4) {\n        let d = this.userSelectSeats[0] - 1\n        this.seats[d].status = 1\n        this.userSelectSeats.splice(0, 1)\n      }\n      this.userSelectSeats.push(index + 1)\n      this.seats[index].status = 2\n      this.cart.price = (this.arrangement.price) * (this.userSelectSeats.length)\n    },\n\n    handleDisSelect(index) {\n      this.seats[index].status = 1\n      this.userSelectSeats.splice(this.userSelectSeats.indexOf(index + 1), 1)\n      this.cart.price = (this.arrangement.price) * (this.userSelectSeats.length)\n    },\n\n    checkPhoneAndSeats() {\n      if (this.userSelectSeats.length === 0) {\n        this.$message({\n          message: '请选择要订购的座位',\n          type: 'warning'\n        });\n        return false;\n      }\n      if (this.cart.phone.length !== 11) {\n        this.$message({\n          message: '请输入11位的电话号码',\n          type: 'warning'\n        });\n        return false;\n      }\n      return true;\n    },\n\n    submitSeat() {\n      if (this.checkPhoneAndSeats()) {\n        for (let i = 0; i < this.userSelectSeats.length; i++) {\n          this.cart.seats += this.userSelectSeats[i] + '号'\n        }\n        console.log(this.cart)\n        CreateCart(this.cart).then(res => {\n          this.$message({\n            message: '以为您添加购物车成功，请尽快付款吧',\n            type: 'success'\n          });\n          this.$router.go(-1)\n        })\n\n      }\n    },\n    submitCart() {\n      if (this.checkPhoneAndSeats()) {\n        this.$confirm('请您仔细确认订单金额为' + this.cart.price + '元, 是否继续?', '提示', {\n          confirmButtonText: '确认支付',\n          cancelButtonText: '取消支付',\n          type: 'success',\n          center: true\n        }).then(() => {\n          for (let i = 0; i < this.userSelectSeats.length; i++) {\n            this.cart.seats += this.userSelectSeats[i] + '号'\n          }\n          //console.log(this.cart)\n          this.cart.status = 2\n          //this.centerDialogVisible = true\n          //this.i = i\n          CreateOrder(this.cart).then(res => {\n            if (res.success) {\n              this.$message({\n                type: 'success',\n                message: '恭喜你支付成功!'\n              });\n            }\n          })\n        }).catch(() => {\n          CreateOrder(this.cart).then(res => {\n            if (res.success) {\n              DeleteCartById(this.selectList[i].cart.id)\n              this.$message({\n                type: 'warning',\n                message: '用户已取消支付, 请您前往我的订单进行支付'\n              });\n              this.loadCarts()\n            }\n          })\n        });\n      }\n    },\n\n  },\n};\n</script>\n\n<style scoped>\n@import \"../assets/css/seat.css\";\n\n.seat-main {\n  padding: 80px;\n}\n\n.seat-content {\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12), 0 0 6px rgba(0, 0, 0, 0.04);\n  height: 850px;\n}\n\n.seat-aside {\n  width: 30%;\n  height: 100%;\n  float: left;\n  background: #f5f6f7;\n}\n\n.seat-aside img {\n  width: 140px;\n  height: 200px;\n}\n\n.seat-select {\n  padding-top: 50px;\n  padding-left: 8%;\n}\n\n.seat-aside-text {\n  padding-top: 8px;\n  font-size: 13px;\n  letter-spacing: 1px;\n  color: #666666;\n}\n\n.d1 {\n  font-size: 16px;\n  letter-spacing: 2px;\n  padding-bottom: 15px;\n}\n\n.d1 span {\n  color: #91949c;\n}\n\n.add-cart-btn {\n  width: 117px;\n}\n\n.item {\n  padding-bottom: 20px;\n}\n\n.row-id {\n  padding-bottom: 11px;\n}\n\n>>> .el-input__inner {\n  border-radius: 50px;\n  height: 55px;\n}\n</style>"]}]}