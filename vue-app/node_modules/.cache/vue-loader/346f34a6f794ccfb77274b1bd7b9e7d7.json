{"remainingRequest":"/Users/xay/MovieTicketSystem/vue-app/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xay/MovieTicketSystem/vue-app/src/views/me/Cart.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/xay/MovieTicketSystem/vue-app/src/views/me/Cart.vue","mtime":1681492251827},{"path":"/Users/xay/MovieTicketSystem/vue-app/node_modules/cache-loader/dist/cjs.js","mtime":1681457359149},{"path":"/Users/xay/MovieTicketSystem/vue-app/node_modules/vue-loader/lib/index.js","mtime":1681457360544}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7RGVsZXRlQ2FydEJ5SWQsIExpc3RDYXJ0c30gZnJvbSAiQC9hcGkvY2FydCIKaW1wb3J0IHtDcmVhdGVPcmRlcn0gZnJvbSAiQC9hcGkvb3JkZXIiOwoKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBpOiAwLAogICAgICBzdWNjZXNzOiBmYWxzZSwKICAgICAgY2VudGVyRGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICBwcmljZTogMCwKICAgICAgc2VsZWN0TGlzdDogW10sCiAgICAgIGNoZWNrQWxsOiBmYWxzZSwKICAgICAgY2FydExpc3Q6IFtdLAogICAgICB1aWQ6IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ1aWQiKSwKICAgIH0KICB9LAoKICBtb3VudGVkKCkgewogICAgdGhpcy5sb2FkQ2FydHMoKQogIH0sCgogIG1ldGhvZHM6IHsKCiAgICBsb2FkQ2FydHMoKSB7CiAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7CiAgICAgIExpc3RDYXJ0cyh0aGlzLnVpZCkudGhlbihyZXMgPT4gewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgdGhpcy5jYXJ0TGlzdCA9IHJlcy5kYXRhCiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY2FydExpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGhpcy5zZWxlY3RMaXN0W2ldID0ge2NoZWNrZWQ6IGZhbHNlLCBjYXJ0OiB0aGlzLmNhcnRMaXN0W2ldLmNhcnR9CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQogICAgICAgIH0sIDcwMCkKICAgICAgfSkKICAgIH0sCgogICAgaGFuZGxlQ2hlY2soKSB7CiAgICAgIHRoaXMuY2hlY2tPdXQoKQogICAgfSwKCiAgICBoYW5kbGVDaGVja0FsbCgpIHsKICAgICAgaWYgKHRoaXMuY2hlY2tBbGwpIHsKICAgICAgICB0aGlzLmNoYW5nZUFsbENoZWNrZWQodHJ1ZSkKICAgICAgICB0aGlzLmNoZWNrT3V0KCkKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNoYW5nZUFsbENoZWNrZWQoZmFsc2UpCiAgICAgICAgdGhpcy5wcmljZSA9IDAKICAgICAgfQogICAgfSwKCiAgICBjaGFuZ2VBbGxDaGVja2VkKHN0YXR1cykgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2VsZWN0TGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuc2VsZWN0TGlzdFtpXS5jaGVja2VkID0gc3RhdHVzCiAgICAgIH0KICAgIH0sCgogICAgY2hlY2tPdXQoKSB7CiAgICAgIHRoaXMucHJpY2UgPSAwCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuc2VsZWN0TGlzdFtpXS5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLnByaWNlICs9IHRoaXMuc2VsZWN0TGlzdFtpXS5jYXJ0LnByaWNlCiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIGhhbmRsZURlbGV0ZShpbmRleCkgewogICAgICBEZWxldGVDYXJ0QnlJZCh0aGlzLmNhcnRMaXN0W2luZGV4XS5jYXJ0LmlkKS50aGVuKHJlcyA9PiB7CiAgICAgICAgY29uc29sZS5sb2cocmVzKQogICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgdGhpcy5jYXJ0TGlzdC5zcGxpY2UoaW5kZXgsIDEpCiAgICAgICAgfQogICAgICB9KQogICAgfSwKCiAgICBzdWJtaXRDYXJ0KCkgewogICAgICB0aGlzLiRjb25maXJtKCfor7fmgqjku5Tnu4bnoa7orqTorqLljZXph5Hpop3kuLonICsgdGhpcy5wcmljZSArICflhYMsIOaYr+WQpue7p+e7rT8nLCAn5o+Q56S6JywgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu6K6k5pSv5LuYJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raI5pSv5LuYJywKICAgICAgICB0eXBlOiAnc3VjY2VzcycsCiAgICAgICAgY2VudGVyOiB0cnVlCiAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAodGhpcy5zZWxlY3RMaXN0W2ldLmNoZWNrZWQpIHsKICAgICAgICAgICAgdGhpcy5zZWxlY3RMaXN0W2ldLmNhcnQuc3RhdHVzID0gMgogICAgICAgICAgICB0aGlzLmNlbnRlckRpYWxvZ1Zpc2libGUgPSB0cnVlCiAgICAgICAgICAgIHRoaXMuaSA9IGkKICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5zZWxlY3RMaXN0W2ldLmNhcnQpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNlbGVjdExpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdExpc3RbaV0uY2hlY2tlZCkgewogICAgICAgICAgICB0aGlzLnNlbGVjdExpc3RbaV0uY2FydC5zdGF0dXMgPSAwCiAgICAgICAgICAgIENyZWF0ZU9yZGVyKHRoaXMuc2VsZWN0TGlzdFtpXS5jYXJ0KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coIui/m+WFpeivpeaWueazlSIpCiAgICAgICAgICAgICAgaWYgKHJlcy5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICBEZWxldGVDYXJ0QnlJZCh0aGlzLnNlbGVjdExpc3RbaV0uY2FydC5pZCkKICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICAgICAgICB0eXBlOiAnd2FybmluZycsCiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfnlKjmiLflt7Llj5bmtojmlK/ku5gsIOivt+aCqOWJjeW+gOaIkeeahOiuouWNlei/m+ihjOaUr+S7mCcKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkQ2FydHMoKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBzdWJtaXRQYXkoKSB7CiAgICAgIGNvbnN0IGkgPSB0aGlzLmkKICAgICAgQ3JlYXRlT3JkZXIodGhpcy5zZWxlY3RMaXN0W2ldLmNhcnQpLnRoZW4ocmVzID0+IHsKICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsKICAgICAgICAgIHRoaXMuY2VudGVyRGlhbG9nVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICBEZWxldGVDYXJ0QnlJZCh0aGlzLnNlbGVjdExpc3RbaV0uY2FydC5pZCkKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsCiAgICAgICAgICAgIG1lc3NhZ2U6ICfmga3llpzkvaDmlK/ku5jmiJDlip8hJwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmxvYWRDYXJ0cygpCiAgICAgICAgfQogICAgICB9KQogICAgfSwKCiAgfSwKCn0K"},{"version":3,"sources":["Cart.vue"],"names":[],"mappings":";AA4DA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA","file":"Cart.vue","sourceRoot":"src/views/me","sourcesContent":["<template>\n  <div style=\"width: 100%\">\n    <h3 style=\"letter-spacing: 1px;font-weight: 400;padding-bottom: 20px\">购物车</h3>\n\n    <div v-loading=\"loading\">\n\n      <el-card v-for=\"(item, index) in cartList\" :key=\"index\" class=\"box-card\">\n        <div>\n          <div style=\"float: left;line-height: 100px;padding-right: 20px\">\n            <el-checkbox @change=\"handleCheck\" v-model=\"selectList[index].checked\"></el-checkbox>\n          </div>\n          <img class=\"item-film-img\" alt=\"\" src=\"../../assets/img/film.png\"/>\n          <div style=\"float: left;\">\n            <div class=\"item-film-name\">《{{ item.film.name }}》</div>\n            <div class=\"item-film-seat\">座位 : {{ item.cart.seats }}</div>\n            <div class=\"item-film-seat\">手机号码 : {{ item.cart.phone }}</div>\n            <div class=\"item-film-time\">开场时间 :\n              <span style=\"color: red\">{{ item.arrangement.date }} - {{ item.arrangement.startTime }}</span>\n            </div>\n          </div>\n          <div style=\"float: right;color: #f34d41;letter-spacing: 2px; line-height: 100px;padding-right: 5px\">\n            ￥{{ item.cart.price }}\n            <el-button @click=\"handleDelete(index)\"\n                       type=\"text\"\n                       style=\"color: red;padding-left: 50px\"\n                       icon=\"el-icon-delete\">删除\n            </el-button>\n          </div>\n        </div>\n      </el-card>\n\n      <div v-if=\"cartList.length !==0\" style=\"height: 60px;background: #91949c\">\n        <div>\n          <div style=\"float: left;line-height: 60px;padding: 0 20px;font-size: 14px\">\n            <el-checkbox @change=\"handleCheckAll\" v-model=\"checkAll\">全 选</el-checkbox>\n          </div>\n          <el-button @click=\"submitCart\" type=\"text\" class=\"sub-btn\">全部结算</el-button>\n          <div class=\"order-footer1\">合计 : ￥{{ price }}</div>\n        </div>\n      </div>\n    </div>\n\n    <el-dialog\n        title=\"扫码支付\"\n        :show-close=\"false\"\n        width=\"30%\"\n        :visible.sync=\"centerDialogVisible\"\n    >\n      <div>\n        <img class=\"c-img\" src=\"../../assets/img/c.jpeg\" alt=\"\">\n      </div>\n      <span slot=\"footer\" class=\"dialog-footer\">\n    <el-button type=\"primary\" @click=\"submitPay\">支 付 成 功</el-button>\n  </span>\n    </el-dialog>\n\n  </div>\n</template>\n\n<script>\nimport {DeleteCartById, ListCarts} from \"@/api/cart\"\nimport {CreateOrder} from \"@/api/order\";\n\nexport default {\n  data() {\n    return {\n      i: 0,\n      success: false,\n      centerDialogVisible: false,\n      loading: false,\n      price: 0,\n      selectList: [],\n      checkAll: false,\n      cartList: [],\n      uid: localStorage.getItem(\"uid\"),\n    }\n  },\n\n  mounted() {\n    this.loadCarts()\n  },\n\n  methods: {\n\n    loadCarts() {\n      this.loading = true;\n      ListCarts(this.uid).then(res => {\n        setTimeout(() => {\n          this.cartList = res.data\n          for (let i = 0; i < this.cartList.length; i++) {\n            this.selectList[i] = {checked: false, cart: this.cartList[i].cart}\n          }\n          this.loading = false\n        }, 700)\n      })\n    },\n\n    handleCheck() {\n      this.checkOut()\n    },\n\n    handleCheckAll() {\n      if (this.checkAll) {\n        this.changeAllChecked(true)\n        this.checkOut()\n      } else {\n        this.changeAllChecked(false)\n        this.price = 0\n      }\n    },\n\n    changeAllChecked(status) {\n      for (let i = 0; i < this.selectList.length; i++) {\n        this.selectList[i].checked = status\n      }\n    },\n\n    checkOut() {\n      this.price = 0\n      for (let i = 0; i < this.selectList.length; i++) {\n        if (this.selectList[i].checked) {\n          this.price += this.selectList[i].cart.price\n        }\n      }\n    },\n\n    handleDelete(index) {\n      DeleteCartById(this.cartList[index].cart.id).then(res => {\n        console.log(res)\n        if (res.success) {\n          this.cartList.splice(index, 1)\n        }\n      })\n    },\n\n    submitCart() {\n      this.$confirm('请您仔细确认订单金额为' + this.price + '元, 是否继续?', '提示', {\n        confirmButtonText: '确认支付',\n        cancelButtonText: '取消支付',\n        type: 'success',\n        center: true\n      }).then(() => {\n        for (let i = 0; i < this.selectList.length; i++) {\n          if (this.selectList[i].checked) {\n            this.selectList[i].cart.status = 2\n            this.centerDialogVisible = true\n            this.i = i\n            console.log(this.selectList[i].cart)\n          }\n        }\n      }).catch(() => {\n        for (let i = 0; i < this.selectList.length; i++) {\n          if (this.selectList[i].checked) {\n            this.selectList[i].cart.status = 0\n            CreateOrder(this.selectList[i].cart).then(res => {\n              console.log(\"进入该方法\")\n              if (res.success) {\n                DeleteCartById(this.selectList[i].cart.id)\n                this.$message({\n                  type: 'warning',\n                  message: '用户已取消支付, 请您前往我的订单进行支付'\n                });\n                this.loadCarts()\n              }\n            })\n          }\n        }\n      });\n    },\n\n    submitPay() {\n      const i = this.i\n      CreateOrder(this.selectList[i].cart).then(res => {\n        if (res.success) {\n          this.centerDialogVisible = false\n          DeleteCartById(this.selectList[i].cart.id)\n          this.$message({\n            type: 'success',\n            message: '恭喜你支付成功!'\n          });\n          this.loadCarts()\n        }\n      })\n    },\n\n  },\n\n}\n</script>\n\n<style scoped>\n\n.box-card {\n  margin-bottom: 5px;\n}\n\n>>> .el-card__header {\n  background: #C0C4CC;\n}\n\n.item-film-img {\n  float: left;\n  width: 80px;\n  height: 100px;\n  padding-bottom: 20px;\n  padding-right: 10px;\n}\n\n.item-film-name {\n  letter-spacing: 2px;\n  font-weight: 500;\n  font-size: 18px;\n  padding-bottom: 13px;\n}\n\n.item-film-seat {\n  letter-spacing: 1px;\n  font-size: 12px;\n  padding-bottom: 8px;\n  padding-left: 10px;\n  color: #91949c;\n}\n\n\n.item-film-time {\n  font-size: 12px;\n  padding-left: 10px;\n  letter-spacing: 1px;\n  color: #91949c;\n}\n\n.c-img {\n  width: 100%;\n  height: 100%;\n}\n\n.sub-btn {\n  float: right;\n  color: #000000;\n  height: 60px;\n  width: 120px;\n  background: #f34d41;\n  letter-spacing: 2px;\n  line-height: 33px;\n  text-align: center;\n  font-weight: 500;\n  font-size: 18px;\n}\n\n.order-footer1 {\n  float: right;\n  line-height: 60px;\n  padding-right: 40px;\n}\n\na {\n  color: #333333;\n}\n\n.di {\n  text-align: center;\n  font-size: 20px;\n  letter-spacing: 3px;\n  font-weight: bold;\n  padding-top: 10px;\n}\n</style>"]}]}