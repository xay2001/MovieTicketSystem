{"remainingRequest":"/Users/xay/MovieTicketSystem/vue-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xay/MovieTicketSystem/vue-admin/src/views/worker/List.vue?vue&type=style&index=0&id=7f721105&scoped=true&lang=css&","dependencies":[{"path":"/Users/xay/MovieTicketSystem/vue-admin/src/views/worker/List.vue","mtime":1642510434000},{"path":"/Users/xay/MovieTicketSystem/vue-admin/node_modules/css-loader/dist/cjs.js","mtime":1681460239567},{"path":"/Users/xay/MovieTicketSystem/vue-admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1681460240371},{"path":"/Users/xay/MovieTicketSystem/vue-admin/node_modules/postcss-loader/src/index.js","mtime":1681460239816},{"path":"/Users/xay/MovieTicketSystem/vue-admin/node_modules/cache-loader/dist/cjs.js","mtime":1681460239186},{"path":"/Users/xay/MovieTicketSystem/vue-admin/node_modules/vue-loader/lib/index.js","mtime":1681460240108}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5kZW1vLXRhYmxlLWV4cGFuZCB7CiAgZm9udC1zaXplOiAwOwp9CgouZGVtby10YWJsZS1leHBhbmQgbGFiZWwgewogIHdpZHRoOiA5MHB4OwogIGNvbG9yOiAjOTlhOWJmOwp9CgouZGVtby10YWJsZS1leHBhbmQgLmVsLWZvcm0taXRlbSB7CiAgbWFyZ2luLXJpZ2h0OiAwOwogIG1hcmdpbi1ib3R0b206IDA7CiAgd2lkdGg6IDUwJTsKfQo="},{"version":3,"sources":["List.vue"],"names":[],"mappings":";AA0RA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"List.vue","sourceRoot":"src/views/worker","sourcesContent":["<template>\n  <div class=\"main\">\n\n    <el-table\n        :data=\"workerList\"\n        style=\"width: 100%\">\n      <el-table-column type=\"expand\">\n        <template slot-scope=\"props\">\n          <el-form label-position=\"left\" inline class=\"demo-table-expand\">\n            <el-form-item label=\"用户名\">\n              <span>{{ props.row.username }}</span>\n            </el-form-item>\n            <el-form-item label=\"昵称\">\n              <span>{{ props.row.nickname }}</span>\n            </el-form-item>\n            <el-form-item label=\"密码\">\n              <el-button type=\"text\" @click=\"openUpdatePassword(props.row)\">\n                <i class=\"el-icon-edit\"></i>编辑密码\n              </el-button>\n            </el-form-item>\n            <el-form-item label=\"联系电话\">\n              <span>{{ props.row.phone }}</span>\n            </el-form-item>\n            <el-form-item label=\"性别\">\n              <span>{{ props.row.gender }}</span>\n            </el-form-item>\n            <el-form-item label=\"入职部门\">\n              <span>{{ props.row.department }}</span>\n            </el-form-item>\n            <el-form-item label=\"状态\">\n              <span v-if=\"props.row.entry\">在职\n              <el-button @click=\"changeEntry(props.$index, props.row)\" type=\"text\">员工已离职？</el-button></span>\n              <span style=\"color: #f56c6c\" v-else>离职</span>\n            </el-form-item>\n            <el-form-item label=\"更新时间\">\n              <span>{{ props.row.updateAt }}</span>\n            </el-form-item>\n            <el-form-item label=\"员工头像\">\n              <a v-if=\"props.row.avatar\" target=\"_blank\" :href=\"props.row.avatar\">\n                <i class=\"el-icon-view\"></i>查看\n              </a>\n              <span v-else>他还没有上传头像</span>\n            </el-form-item>\n            <el-form-item>\n              <el-button :disabled=\"!props.row.entry\"\n                         @click=\"handleListRole(props.row)\"\n                         type=\"info\"\n                         size=\"small\"\n                         plain>查看权限\n              </el-button>\n              <el-button :disabled=\"!props.row.entry\"\n                         type=\"primary\"\n                         @click=\"handleAddRole(props.row)\"\n                         size=\"small\"\n                         plain>添加权限\n              </el-button>\n              <el-button :disabled=\"props.row.entry\"\n                         @click=\"handleDeleteWork(props.$index, props.row.id)\"\n                         size=\"small\"\n                         type=\"danger\"\n                         plain>删除员工\n              </el-button>\n            </el-form-item>\n          </el-form>\n        </template>\n      </el-table-column>\n\n      <el-table-column\n          label=\"员工 ID\"\n          width=\"430\"\n          prop=\"id\">\n      </el-table-column>\n      <el-table-column\n          label=\"用户名\"\n          width=\"200\"\n          prop=\"username\">\n      </el-table-column>\n      <el-table-column\n          label=\"所在部门\"\n          width=\"150\">\n        <template slot-scope=\"scope\">\n          <el-tag>{{ scope.row.department }}</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column\n          label=\"联系电话\"\n          width=\"240\"\n          prop=\"phone\">\n      </el-table-column>\n      <el-table-column\n          label=\"入职时间\"\n          prop=\"createAt\">\n      </el-table-column>\n\n    </el-table>\n\n    <el-dialog title=\"员工权限\" :visible.sync=\"roleDialogVisible\">\n      <el-table v-loading=\"loading\" :data=\"roleList\">\n        <el-table-column property=\"value\" label=\"权限\" width=\"300\"></el-table-column>\n        <el-table-column property=\"createAt\" label=\"创建时间\" width=\"300\"></el-table-column>\n        <el-table-column label=\"操作\">\n          <template slot-scope=\"scope\">\n            <el-popconfirm\n                @confirm=\"handleDeleteRole(scope.$index, scope.row.id)\"\n                :title=\"'确定删除权限 < ' + scope.row.value +' > 吗？'\"\n            >\n              <el-button slot=\"reference\" size=\"small\" type=\"danger\" icon=\"el-icon-delete\" plain>删除</el-button>\n            </el-popconfirm>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-dialog>\n\n    <el-dialog width=\"450px\" title=\"新增权限\" :visible.sync=\"dialogFormVisible\">\n      <el-form :model=\"addRoleForm\">\n        <el-form-item label=\"权限列表\" label-width=\"120px\">\n          <el-select v-model=\"addRoleForm.value\" placeholder=\"请选择新增的权限\">\n            <el-option v-for=\"(item, index) in systemRoles\"\n                       :key=\"index\"\n                       :label=\"item\"\n                       :value=\"item\">\n            </el-option>\n          </el-select>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submitAddRole\">确 定</el-button>\n      </div>\n    </el-dialog>\n\n  </div>\n</template>\n\n<script>\nimport {\n  CreateWorkerRole,\n  DeleteRoleByWorkerId,\n  DeleteWorker,\n  FindAllWorker,\n  FindWorkerRoles,\n  ListSystemRoles,\n  UpdateWorker\n} from \"@/api/worker\";\n\nexport default {\n\n\n  data() {\n    return {\n      loading: false,\n      addRoleForm: {\n        wid: '',\n        value: '',\n      },\n      workerList: [],\n      systemRoles: [],\n      roleDialogVisible: false,\n      roleList: [],\n      dialogFormVisible: false,\n    }\n  },\n\n  mounted() {\n    FindAllWorker().then(res => {\n      this.workerList = res.data\n    })\n    ListSystemRoles().then(res => {\n      this.systemRoles = res.data\n    })\n  },\n\n  methods: {\n\n    openUpdatePassword(worker) {\n      this.$prompt('请输入新的密码', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n      }).then(({value}) => {\n        if (!value) {\n          this.$message({\n            message: '密码不能为空',\n            type: 'danger',\n          });\n          return\n        }\n        if (value.length < 6) {\n          this.$message({\n            message: '请输入不少于6位的密码',\n            type: 'danger',\n          });\n          return\n        }\n        worker.password = value\n        UpdateWorker(worker).then(res => {\n          this.$message({\n            message: '账号密码修改成功',\n            type: 'success',\n          });\n        })\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '取消修改'\n        });\n      });\n    },\n\n    changeEntry(index, worker) {\n      this.$confirm('此操作将该员工状态永久修改为离职, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        worker.entry = false\n        UpdateWorker(worker).then(res => {\n          this.$message({\n            type: 'success',\n            message: '员工离职成功!'\n          });\n        })\n      })\n    },\n\n    handleDeleteWork(index, id) {\n      DeleteWorker(id).then(res => {\n        this.workerList.splice(index, 1)\n        this.$message({\n          type: 'success',\n          message: '员工信息删除成功!'\n        });\n      })\n    },\n\n    handleListRole(worker) {\n      this.roleDialogVisible = true;\n      this.loading = true;\n      FindWorkerRoles(worker.id).then(res => {\n        setTimeout(() => {\n          this.roleList = res.data\n          this.loading = false;\n        }, 700)\n      })\n    },\n\n    handleDeleteRole(index, id) {\n      DeleteRoleByWorkerId(id).then(res => {\n        if (res.success === true) {\n          this.roleList.splice(index, 1)\n          this.$message({\n            type: 'success',\n            message: '员工权限删除成功!'\n          });\n        }\n      })\n    },\n\n    handleAddRole(worker) {\n      this.dialogFormVisible = true;\n      this.addRoleForm.wid = worker.id;\n    },\n\n    submitAddRole() {\n      CreateWorkerRole(this.addRoleForm).then(res => {\n        if (res.success) {\n          this.dialogFormVisible = false;\n          this.addRoleForm.wid = '';\n          this.addRoleForm.value = '';\n          this.$message({\n            type: 'success',\n            message: '员工权限添加成功!'\n          });\n        }\n      })\n    },\n\n  },\n\n}\n</script>\n\n<style scoped>\n.demo-table-expand {\n  font-size: 0;\n}\n\n.demo-table-expand label {\n  width: 90px;\n  color: #99a9bf;\n}\n\n.demo-table-expand .el-form-item {\n  margin-right: 0;\n  margin-bottom: 0;\n  width: 50%;\n}\n</style>"]}]}