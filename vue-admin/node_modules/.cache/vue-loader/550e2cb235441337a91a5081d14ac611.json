{"remainingRequest":"/Users/xay/MovieTicketSystem/vue-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xay/MovieTicketSystem/vue-admin/src/views/worker/List.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/xay/MovieTicketSystem/vue-admin/src/views/worker/List.vue","mtime":1642510434000},{"path":"/Users/xay/MovieTicketSystem/vue-admin/node_modules/cache-loader/dist/cjs.js","mtime":1681460239186},{"path":"/Users/xay/MovieTicketSystem/vue-admin/node_modules/vue-loader/lib/index.js","mtime":1681460240108}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7CiAgQ3JlYXRlV29ya2VyUm9sZSwKICBEZWxldGVSb2xlQnlXb3JrZXJJZCwKICBEZWxldGVXb3JrZXIsCiAgRmluZEFsbFdvcmtlciwKICBGaW5kV29ya2VyUm9sZXMsCiAgTGlzdFN5c3RlbVJvbGVzLAogIFVwZGF0ZVdvcmtlcgp9IGZyb20gIkAvYXBpL3dvcmtlciI7CgpleHBvcnQgZGVmYXVsdCB7CgoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIGFkZFJvbGVGb3JtOiB7CiAgICAgICAgd2lkOiAnJywKICAgICAgICB2YWx1ZTogJycsCiAgICAgIH0sCiAgICAgIHdvcmtlckxpc3Q6IFtdLAogICAgICBzeXN0ZW1Sb2xlczogW10sCiAgICAgIHJvbGVEaWFsb2dWaXNpYmxlOiBmYWxzZSwKICAgICAgcm9sZUxpc3Q6IFtdLAogICAgICBkaWFsb2dGb3JtVmlzaWJsZTogZmFsc2UsCiAgICB9CiAgfSwKCiAgbW91bnRlZCgpIHsKICAgIEZpbmRBbGxXb3JrZXIoKS50aGVuKHJlcyA9PiB7CiAgICAgIHRoaXMud29ya2VyTGlzdCA9IHJlcy5kYXRhCiAgICB9KQogICAgTGlzdFN5c3RlbVJvbGVzKCkudGhlbihyZXMgPT4gewogICAgICB0aGlzLnN5c3RlbVJvbGVzID0gcmVzLmRhdGEKICAgIH0pCiAgfSwKCiAgbWV0aG9kczogewoKICAgIG9wZW5VcGRhdGVQYXNzd29yZCh3b3JrZXIpIHsKICAgICAgdGhpcy4kcHJvbXB0KCfor7fovpPlhaXmlrDnmoTlr4bnoIEnLCAn5o+Q56S6JywgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu5a6aJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgfSkudGhlbigoe3ZhbHVlfSkgPT4gewogICAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICBtZXNzYWdlOiAn5a+G56CB5LiN6IO95Li656m6JywKICAgICAgICAgICAgdHlwZTogJ2RhbmdlcicsCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBpZiAodmFsdWUubGVuZ3RoIDwgNikgewogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgIG1lc3NhZ2U6ICfor7fovpPlhaXkuI3lsJHkuo425L2N55qE5a+G56CBJywKICAgICAgICAgICAgdHlwZTogJ2RhbmdlcicsCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICB3b3JrZXIucGFzc3dvcmQgPSB2YWx1ZQogICAgICAgIFVwZGF0ZVdvcmtlcih3b3JrZXIpLnRoZW4ocmVzID0+IHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICBtZXNzYWdlOiAn6LSm5Y+35a+G56CB5L+u5pS55oiQ5YqfJywKICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLAogICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgfSkuY2F0Y2goKCkgPT4gewogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgdHlwZTogJ2luZm8nLAogICAgICAgICAgbWVzc2FnZTogJ+WPlua2iOS/ruaUuScKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAoKICAgIGNoYW5nZUVudHJ5KGluZGV4LCB3b3JrZXIpIHsKICAgICAgdGhpcy4kY29uZmlybSgn5q2k5pON5L2c5bCG6K+l5ZGY5bel54q25oCB5rC45LmF5L+u5pS55Li656a76IGMLCDmmK/lkKbnu6fnu60/JywgJ+aPkOekuicsIHsKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruWumicsCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsCiAgICAgICAgdHlwZTogJ3dhcm5pbmcnCiAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgIHdvcmtlci5lbnRyeSA9IGZhbHNlCiAgICAgICAgVXBkYXRlV29ya2VyKHdvcmtlcikudGhlbihyZXMgPT4gewogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywKICAgICAgICAgICAgbWVzc2FnZTogJ+WRmOW3peemu+iBjOaIkOWKnyEnCiAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICB9KQogICAgfSwKCiAgICBoYW5kbGVEZWxldGVXb3JrKGluZGV4LCBpZCkgewogICAgICBEZWxldGVXb3JrZXIoaWQpLnRoZW4ocmVzID0+IHsKICAgICAgICB0aGlzLndvcmtlckxpc3Quc3BsaWNlKGluZGV4LCAxKQogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLAogICAgICAgICAgbWVzc2FnZTogJ+WRmOW3peS/oeaBr+WIoOmZpOaIkOWKnyEnCiAgICAgICAgfSk7CiAgICAgIH0pCiAgICB9LAoKICAgIGhhbmRsZUxpc3RSb2xlKHdvcmtlcikgewogICAgICB0aGlzLnJvbGVEaWFsb2dWaXNpYmxlID0gdHJ1ZTsKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgRmluZFdvcmtlclJvbGVzKHdvcmtlci5pZCkudGhlbihyZXMgPT4gewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgdGhpcy5yb2xlTGlzdCA9IHJlcy5kYXRhCiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9LCA3MDApCiAgICAgIH0pCiAgICB9LAoKICAgIGhhbmRsZURlbGV0ZVJvbGUoaW5kZXgsIGlkKSB7CiAgICAgIERlbGV0ZVJvbGVCeVdvcmtlcklkKGlkKS50aGVuKHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcy5zdWNjZXNzID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLnJvbGVMaXN0LnNwbGljZShpbmRleCwgMSkKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsCiAgICAgICAgICAgIG1lc3NhZ2U6ICflkZjlt6XmnYPpmZDliKDpmaTmiJDlip8hJwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KQogICAgfSwKCiAgICBoYW5kbGVBZGRSb2xlKHdvcmtlcikgewogICAgICB0aGlzLmRpYWxvZ0Zvcm1WaXNpYmxlID0gdHJ1ZTsKICAgICAgdGhpcy5hZGRSb2xlRm9ybS53aWQgPSB3b3JrZXIuaWQ7CiAgICB9LAoKICAgIHN1Ym1pdEFkZFJvbGUoKSB7CiAgICAgIENyZWF0ZVdvcmtlclJvbGUodGhpcy5hZGRSb2xlRm9ybSkudGhlbihyZXMgPT4gewogICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgdGhpcy5kaWFsb2dGb3JtVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgdGhpcy5hZGRSb2xlRm9ybS53aWQgPSAnJzsKICAgICAgICAgIHRoaXMuYWRkUm9sZUZvcm0udmFsdWUgPSAnJzsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsCiAgICAgICAgICAgIG1lc3NhZ2U6ICflkZjlt6XmnYPpmZDmt7vliqDmiJDlip8hJwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KQogICAgfSwKCiAgfSwKCn0K"},{"version":3,"sources":["List.vue"],"names":[],"mappings":";AAuIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA","file":"List.vue","sourceRoot":"src/views/worker","sourcesContent":["<template>\n  <div class=\"main\">\n\n    <el-table\n        :data=\"workerList\"\n        style=\"width: 100%\">\n      <el-table-column type=\"expand\">\n        <template slot-scope=\"props\">\n          <el-form label-position=\"left\" inline class=\"demo-table-expand\">\n            <el-form-item label=\"用户名\">\n              <span>{{ props.row.username }}</span>\n            </el-form-item>\n            <el-form-item label=\"昵称\">\n              <span>{{ props.row.nickname }}</span>\n            </el-form-item>\n            <el-form-item label=\"密码\">\n              <el-button type=\"text\" @click=\"openUpdatePassword(props.row)\">\n                <i class=\"el-icon-edit\"></i>编辑密码\n              </el-button>\n            </el-form-item>\n            <el-form-item label=\"联系电话\">\n              <span>{{ props.row.phone }}</span>\n            </el-form-item>\n            <el-form-item label=\"性别\">\n              <span>{{ props.row.gender }}</span>\n            </el-form-item>\n            <el-form-item label=\"入职部门\">\n              <span>{{ props.row.department }}</span>\n            </el-form-item>\n            <el-form-item label=\"状态\">\n              <span v-if=\"props.row.entry\">在职\n              <el-button @click=\"changeEntry(props.$index, props.row)\" type=\"text\">员工已离职？</el-button></span>\n              <span style=\"color: #f56c6c\" v-else>离职</span>\n            </el-form-item>\n            <el-form-item label=\"更新时间\">\n              <span>{{ props.row.updateAt }}</span>\n            </el-form-item>\n            <el-form-item label=\"员工头像\">\n              <a v-if=\"props.row.avatar\" target=\"_blank\" :href=\"props.row.avatar\">\n                <i class=\"el-icon-view\"></i>查看\n              </a>\n              <span v-else>他还没有上传头像</span>\n            </el-form-item>\n            <el-form-item>\n              <el-button :disabled=\"!props.row.entry\"\n                         @click=\"handleListRole(props.row)\"\n                         type=\"info\"\n                         size=\"small\"\n                         plain>查看权限\n              </el-button>\n              <el-button :disabled=\"!props.row.entry\"\n                         type=\"primary\"\n                         @click=\"handleAddRole(props.row)\"\n                         size=\"small\"\n                         plain>添加权限\n              </el-button>\n              <el-button :disabled=\"props.row.entry\"\n                         @click=\"handleDeleteWork(props.$index, props.row.id)\"\n                         size=\"small\"\n                         type=\"danger\"\n                         plain>删除员工\n              </el-button>\n            </el-form-item>\n          </el-form>\n        </template>\n      </el-table-column>\n\n      <el-table-column\n          label=\"员工 ID\"\n          width=\"430\"\n          prop=\"id\">\n      </el-table-column>\n      <el-table-column\n          label=\"用户名\"\n          width=\"200\"\n          prop=\"username\">\n      </el-table-column>\n      <el-table-column\n          label=\"所在部门\"\n          width=\"150\">\n        <template slot-scope=\"scope\">\n          <el-tag>{{ scope.row.department }}</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column\n          label=\"联系电话\"\n          width=\"240\"\n          prop=\"phone\">\n      </el-table-column>\n      <el-table-column\n          label=\"入职时间\"\n          prop=\"createAt\">\n      </el-table-column>\n\n    </el-table>\n\n    <el-dialog title=\"员工权限\" :visible.sync=\"roleDialogVisible\">\n      <el-table v-loading=\"loading\" :data=\"roleList\">\n        <el-table-column property=\"value\" label=\"权限\" width=\"300\"></el-table-column>\n        <el-table-column property=\"createAt\" label=\"创建时间\" width=\"300\"></el-table-column>\n        <el-table-column label=\"操作\">\n          <template slot-scope=\"scope\">\n            <el-popconfirm\n                @confirm=\"handleDeleteRole(scope.$index, scope.row.id)\"\n                :title=\"'确定删除权限 < ' + scope.row.value +' > 吗？'\"\n            >\n              <el-button slot=\"reference\" size=\"small\" type=\"danger\" icon=\"el-icon-delete\" plain>删除</el-button>\n            </el-popconfirm>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-dialog>\n\n    <el-dialog width=\"450px\" title=\"新增权限\" :visible.sync=\"dialogFormVisible\">\n      <el-form :model=\"addRoleForm\">\n        <el-form-item label=\"权限列表\" label-width=\"120px\">\n          <el-select v-model=\"addRoleForm.value\" placeholder=\"请选择新增的权限\">\n            <el-option v-for=\"(item, index) in systemRoles\"\n                       :key=\"index\"\n                       :label=\"item\"\n                       :value=\"item\">\n            </el-option>\n          </el-select>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submitAddRole\">确 定</el-button>\n      </div>\n    </el-dialog>\n\n  </div>\n</template>\n\n<script>\nimport {\n  CreateWorkerRole,\n  DeleteRoleByWorkerId,\n  DeleteWorker,\n  FindAllWorker,\n  FindWorkerRoles,\n  ListSystemRoles,\n  UpdateWorker\n} from \"@/api/worker\";\n\nexport default {\n\n\n  data() {\n    return {\n      loading: false,\n      addRoleForm: {\n        wid: '',\n        value: '',\n      },\n      workerList: [],\n      systemRoles: [],\n      roleDialogVisible: false,\n      roleList: [],\n      dialogFormVisible: false,\n    }\n  },\n\n  mounted() {\n    FindAllWorker().then(res => {\n      this.workerList = res.data\n    })\n    ListSystemRoles().then(res => {\n      this.systemRoles = res.data\n    })\n  },\n\n  methods: {\n\n    openUpdatePassword(worker) {\n      this.$prompt('请输入新的密码', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n      }).then(({value}) => {\n        if (!value) {\n          this.$message({\n            message: '密码不能为空',\n            type: 'danger',\n          });\n          return\n        }\n        if (value.length < 6) {\n          this.$message({\n            message: '请输入不少于6位的密码',\n            type: 'danger',\n          });\n          return\n        }\n        worker.password = value\n        UpdateWorker(worker).then(res => {\n          this.$message({\n            message: '账号密码修改成功',\n            type: 'success',\n          });\n        })\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '取消修改'\n        });\n      });\n    },\n\n    changeEntry(index, worker) {\n      this.$confirm('此操作将该员工状态永久修改为离职, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        worker.entry = false\n        UpdateWorker(worker).then(res => {\n          this.$message({\n            type: 'success',\n            message: '员工离职成功!'\n          });\n        })\n      })\n    },\n\n    handleDeleteWork(index, id) {\n      DeleteWorker(id).then(res => {\n        this.workerList.splice(index, 1)\n        this.$message({\n          type: 'success',\n          message: '员工信息删除成功!'\n        });\n      })\n    },\n\n    handleListRole(worker) {\n      this.roleDialogVisible = true;\n      this.loading = true;\n      FindWorkerRoles(worker.id).then(res => {\n        setTimeout(() => {\n          this.roleList = res.data\n          this.loading = false;\n        }, 700)\n      })\n    },\n\n    handleDeleteRole(index, id) {\n      DeleteRoleByWorkerId(id).then(res => {\n        if (res.success === true) {\n          this.roleList.splice(index, 1)\n          this.$message({\n            type: 'success',\n            message: '员工权限删除成功!'\n          });\n        }\n      })\n    },\n\n    handleAddRole(worker) {\n      this.dialogFormVisible = true;\n      this.addRoleForm.wid = worker.id;\n    },\n\n    submitAddRole() {\n      CreateWorkerRole(this.addRoleForm).then(res => {\n        if (res.success) {\n          this.dialogFormVisible = false;\n          this.addRoleForm.wid = '';\n          this.addRoleForm.value = '';\n          this.$message({\n            type: 'success',\n            message: '员工权限添加成功!'\n          });\n        }\n      })\n    },\n\n  },\n\n}\n</script>\n\n<style scoped>\n.demo-table-expand {\n  font-size: 0;\n}\n\n.demo-table-expand label {\n  width: 90px;\n  color: #99a9bf;\n}\n\n.demo-table-expand .el-form-item {\n  margin-right: 0;\n  margin-bottom: 0;\n  width: 50%;\n}\n</style>"]}]}